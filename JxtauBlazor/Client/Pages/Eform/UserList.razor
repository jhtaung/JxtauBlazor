@page "/eform-users"
@inject HttpClient client
@inject IJSRuntime js

<MudContainer Class="mt-5" MaxWidth="MaxWidth.ExtraLarge">
    <MudText Typo="Typo.h5" GutterBottom="true">Eform Users</MudText>

    @if (isLoading)
    {
        <MudText Typo="Typo.body2" GutterBottom="true">
            Loading...
        </MudText>
    }
    else if (eformUserList.Count == 0 && devUserList.Count == 0)
    {
        <MudText Typo="Typo.body2" GutterBottom="true">
            No records found.
        </MudText>
    }
    else
    {
        <MudTable 
            Class="mb-5"
            Items="@devUserList" 
            SortLabel="Sort By" 
            Dense="@true" 
            Hover="@true" 
            Bordered="@true" 
            Striped="@true"
            RowsPerPage="25">
            <ToolBarContent>
                <MudText Typo="Typo.h6">Found Dev Users</MudText>
            </ToolBarContent>
            <ColGroup>
                <col style="width: 20%;" />
                <col style="width: 20%;" />
                <col style="width: 20%;" />
                <col style="width: 20%;" />
                <col style="width: 20%;" />
            </ColGroup>
            <HeaderContent>
                <MudTh><MudTableSortLabel SortBy="new Func<Value, object>(x=>x.id)">Id</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<Value, object>(x=>x.username)">User Name</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<Value, object>(x=>x.firstName)">First Name</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<Value, object>(x=>x.lastName)">Last Name</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<Value, object>(x=>x.disabled)">Disabled</MudTableSortLabel></MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Id">@context.id</MudTd>
                <MudTd DataLabel="Username">@context.username</MudTd>
                <MudTd DataLabel="First Name">@context.firstName</MudTd>
                <MudTd DataLabel="Last Name">@context.lastName</MudTd>
                <MudTd DataLabel="Disabled">@context.disabled</MudTd>
            </RowTemplate>
            <PagerContent>
                <MudTablePager PageSizeOptions="@pageSizeOptions" />
            </PagerContent>
        </MudTable>

        <MudTable 
            Class="mb-5"
            Items="@eformUserList" 
            SortLabel="Sort By" 
            Dense="@true" 
            Hover="@true" 
            Bordered="@true" 
            Striped="@true"
            RowsPerPage="25">
            <ToolBarContent>
                <MudText Typo="Typo.h6">Eform Users</MudText>
            </ToolBarContent>
            <ColGroup>
                <col style="width: 20%;" />
                <col style="width: 20%;" />
                <col style="width: 20%;" />
                <col style="width: 20%;" />
                <col style="width: 20%;" />
            </ColGroup>
            <HeaderContent>
                <MudTh><MudTableSortLabel SortBy="new Func<Value, object>(x => x.id)">Id</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<Value, object>(x => x.username)">User Name</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<Value, object>(x => x.firstName)">First Name</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<Value, object>(x => x.lastName)">Last Name</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<Value, object>(x => x.disabled)">Disabled</MudTableSortLabel></MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Id">@context.id</MudTd>
                <MudTd DataLabel="Username">@context.username</MudTd>
                <MudTd DataLabel="First Name">@context.firstName</MudTd>
                <MudTd DataLabel="Last Name">@context.lastName</MudTd>
                <MudTd DataLabel="Disabled">@context.disabled</MudTd>
            </RowTemplate>
            <PagerContent>
                <MudTablePager PageSizeOptions="@pageSizeOptions" />
            </PagerContent>
        </MudTable>
    }
</MudContainer>

@code {
    private bool isLoading = false;
    private int[] pageSizeOptions = new int[] { 10, 25, 50, 100 };

    EformUsers eformUsers { get; set; } = new EformUsers();
    List<Value> eformUserList = new List<Value>() { };
    List<Value> devUserList = new List<Value>() { };
    List<string> devUsers = new List<string>() { 
        "admin", 
        "jhtaung",
        "Guest",
        "mmurshed",
        "mwhelpley",
        "tmazumder"
    };

    protected override async Task OnInitializedAsync()
    {
        isLoading = true;
        var response = await client.GetFromJsonAsync<EformUsers>("api/eform/users");
        eformUsers = response!;

        for (int i = 0; i < eformUsers.value!.Count; i++) {
            var eformUser = eformUsers.value[i];
            if (devUsers.Contains(eformUser.username!)) {
                devUserList.Add(eformUsers.value[i]);
            } else {
                eformUserList.Add(eformUser);
            }
        }

        isLoading = false;
    }
}